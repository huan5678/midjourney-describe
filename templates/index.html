<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,typography,aspect-ratio,line-clamp"></script>
    <link rel="shortcut icon" href="data:image/svg+xml,<svg id='Capa_1' enable-background='new 0 0 512 512' viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'><g><path d='m141.495 426.839-28.167-70.593-85.161 127.587 28.167 28.167z' fill='%23373e69'/><path d='m85.161 370.505-85.161 85.161 28.167 28.167 106.374-106.374z' fill='%2353597e'/><path d='m141.495 426.839 73.854-73.854-49.38-49.38-52.641 95.067z' fill='%23aaacbc'/><path d='m83.949 327.745h104.445v39.834h-104.445z' fill='%23c5c6ce' transform='matrix(.707 -.707 .707 .707 -205.95 198.116)'/><path d='m451.331 353.605c-80.892 80.892-212.044 80.892-292.936 0l73.234-219.702 219.702-73.234c80.892 80.892 80.892 212.044 0 292.936z' fill='%2353597e'/><path d='m451.331 60.669-292.936 292.936c-80.892-80.892-80.892-212.044 0-292.936s212.044-80.892 292.936 0z' fill='%23707492'/><path d='m406.264 308.538c-56.002 56.002-146.8 56.002-202.802 0l50.7-152.101 152.101-50.7c56.003 56.001 56.003 146.799.001 202.801z' fill='%238c8fa7'/><path d='m406.264 105.736c-56.002-56.002-146.8-56.002-202.802 0l29.643 71.758 71.758 29.643z' fill='%2394f06d'/><path d='m203.462 105.736c-56.002 56.002-56.002 146.8 0 202.802l101.401-101.401z' fill='%23aaacbc'/><path d='m349.93 252.204c-24.89 24.89-65.244 24.89-90.134 0l22.534-67.601 67.601-22.534c24.889 24.891 24.889 65.245-.001 90.135z' fill='%23f2f2f2'/><path d='m349.93 162.07-90.134 90.134c-24.89-24.89-24.89-65.244 0-90.134s65.244-24.89 90.134 0z' fill='%23fff'/></g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/></svg>">

    <script>
      tailwind.config = {
        theme: {
          container: {
            center: true,
            padding: '1rem',
          },
          extend: {
            colors: {
              primary: {
                50: '#f4f4f6',
                100: '#eaeaed',
                200: '#cacad2',
                300: '#aaabb7',
                400: '#6a6b81',
                500: '#2a2c4b',
                600: '#262844',
                700: '#202138',
                800: '#191a2d',
                900: '#151625',
              },
            },
          },
        },
      };
    </script>
    <!-- <script src="static/script.js" defer></script> -->
    <title>Process String</title>
  </head>
  <body class="bg-primary-200">
    <main class="container">
      <form class="flex flex-col gap-4 py-4">
        <h1 class="text-xl md:text-4xl">Midjourney Describe Prompt Processor</h1>
        <label
          for="input_string"
          class="block text-sm font-medium font-semibold leading-6 text-primary-900"
          >Input String:
        </label>
        <textarea
          id="input_string"
          rows="10"
          cols="50"
          class="block bg-primary-100 w-full rounded-lg border-0 py-1.5 text-primary-900 shadow-sm ring-1 ring-inset ring-primary-300 placeholder:text-primary-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
        ></textarea>
        <div class="flex flex-row flex-wrap gap-4 items-end justify-between">
          <div class="grid grid-cols-2 items-center gap-4">
            <div class="flex flex-col gap-1">
              <label
                for="ar"
                class="block text-sm font-medium font-semibold leading-6 text-primary-900"
                >AR:
              </label>
              <input
                type="text"
                id="ar"
                class="block bg-primary-100 w-full border-0 rounded-lg py-1.5 text-primary-900 shadow-sm ring-1 ring-inset ring-primary-300 placeholder:text-primary-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
              />
            </div>
            <div class="flex flex-col gap-1">
              <label
                for="prefix"
                class="block text-sm font-medium font-semibold leading-6 text-primary-900"
                >Prefix:
              </label>
              <input
                type="text"
                id="prefix"
                class="block bg-primary-100 w-full border-0 py-1.5 rounded-lg text-primary-900 shadow-sm ring-1 ring-inset ring-primary-300 placeholder:text-primary-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6"
                value="7 --p, n --p"
              />
            </div>
          </div>
          <div class="flex flex-wrap md:flex-no-wrap justify-between items-center gap-4 w-full md:w-auto">
            <button
              type="button"
              id="process"
              class="w-full md:w-auto px-6 py-3 text-sm font-semibold transition duration-300 ease-in-out border-0 rounded-md shadow-sm text-primary-100 outline-primary-500 outline border-primary-500 bg-primary-400 hover:bg-primary-700 hover:text-primary-50 hover:outline-primary-400 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
            >
              Process
            </button>
            <button
              type="button"
              id="copy"
              class="w-full md:w-auto px-6 py-3 text-sm font-semibold transition duration-300 ease-in-out border-0 rounded-md shadow-sm outline-primary-500 outline text-primary-500 border-primary-500 hover:bg-amber-400 hover:text-primary-50 hover:outline-amber-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
            >
              CopyResult
            </button>
            <button
              type="button"
              id="clear"
              class="w-full md:w-auto px-6 py-3 text-sm font-semibold transition duration-300 ease-in-out border-0 rounded-md shadow-sm outline-primary-500 outline text-primary-500 border-primary-500 hover:bg-red-400 hover:text-primary-50 hover:outline-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-600"
            >
              ClearInput
            </button>
          </div>
        </div>
      </form>
      <div id="results"></div>
    </main>
    <script>
document.addEventListener("DOMContentLoaded", function() {
  const processButton = document.getElementById("process");
  const clearButton = document.getElementById("clear");
  const copyButton = document.getElementById("copy");
  const inputTextArea = document.getElementById("input_string");
  const resultsDiv = document.getElementById("results");
  const prefixInput = document.getElementById("prefix");
  const arInput = document.getElementById("ar");

  // 從 localStorage 讀取存儲的 prefix 和 ar，如果有的話
  const savedPrefix = localStorage.getItem("midjourney_prefix");
  if (savedPrefix) {
    prefixInput.value = savedPrefix;
  }

  const savedAr = localStorage.getItem("midjourney_ar");
  if (savedAr) {
    arInput.value = savedAr;
  }

  // 監聽 prefix 輸入框的變化，並儲存到 localStorage
  prefixInput.addEventListener("change", function() {
    localStorage.setItem("midjourney_prefix", prefixInput.value);
  });

  // 也監聽 input 事件，這樣當使用者邊輸入時就會保存
  prefixInput.addEventListener("input", function() {
    localStorage.setItem("midjourney_prefix", prefixInput.value);
  });

  // 同樣為 ar 輸入框添加監聽事件
  arInput.addEventListener("change", function() {
    localStorage.setItem("midjourney_ar", arInput.value);
  });

  arInput.addEventListener("input", function() {
    localStorage.setItem("midjourney_ar", arInput.value);
  });

  // 也可以在按下 Process 按鈕時儲存，以確保捕捉所有變更
  processButton.addEventListener("click", async function() {
    const input_string = inputTextArea.value;
    const prefix = prefixInput.value;
    const ar = arInput.value;

    // 儲存當前的 prefix 和 ar 到 localStorage
    localStorage.setItem("midjourney_prefix", prefix);
    localStorage.setItem("midjourney_ar", ar);

    const response = await fetch("/process", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({
        input_string: input_string,
        prefix: prefix,
        ar: ar
      })
    });

    const result = await response.text();
    resultsDiv.innerHTML = `<textarea readonly rows="4" cols="50" class="block bg-primary-100 w-full rounded-lg border-0 py-1.5 text-primary-900 shadow-sm ring-1 ring-inset ring-primary-300 placeholder:text-primary-400 focus:ring-2 focus:ring-inset focus:ring-primary-600 sm:text-sm sm:leading-6">${result}</textarea>`;
  });

  clearButton.addEventListener("click", function() {
    inputTextArea.value = "";
  });

  copyButton.addEventListener("click", function() {
    const resultTextArea = document.querySelector("#results textarea");
    if (resultTextArea) {
      resultTextArea.select();
      document.execCommand("copy");
    }
  });
});
</script>

  </body>
</html>
